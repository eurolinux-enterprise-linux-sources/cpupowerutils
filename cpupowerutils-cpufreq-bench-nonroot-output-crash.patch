diff -up ./cpupower/bench/parse.c.orig ./cpupower/bench/parse.c
--- ./cpupower/bench/parse.c.orig	2012-06-12 15:10:58.000000000 -0400
+++ ./cpupower/bench/parse.c	2012-12-17 14:54:59.252299918 -0500
@@ -160,17 +160,18 @@ int prepare_config(const char *path, str
 	size_t len = 0;
 	char *opt, *val, *line = NULL;
 	FILE *configfile = fopen(path, "r");
+	int rc = 1;
 
 	if (config == NULL) {
 		fprintf(stderr, "error: config is NULL\n");
-		return 1;
+		goto out;
 	}
 
 	if (configfile == NULL) {
 		perror("fopen");
 		fprintf(stderr, "error: unable to read configfile\n");
 		free(config);
-		return 1;
+		goto out;
 	}
 
 	while (getline(&line, &len, configfile) != -1) {
@@ -202,8 +203,13 @@ int prepare_config(const char *path, str
 		else if (strncmp("verbose", opt, strlen(opt)) == 0)
 			sscanf(val, "%u", &config->verbose);
 
-		else if (strncmp("output", opt, strlen(opt)) == 0)
+		else if (strncmp("output", opt, strlen(opt)) == 0) {
 			config->output = prepare_output(val); 
+			if (!config->output) {
+				rc = 1;
+				goto out_free;
+			}
+		}
 
 		else if (strncmp("cpu", opt, strlen(opt)) == 0)
 			sscanf(val, "%u", &config->cpu);
@@ -217,9 +223,13 @@ int prepare_config(const char *path, str
 		}
 	}
 
+out_free:
+	if (rc && config->output && config->output != stdout)
+		fclose(config->output);
 	free(line);
 	free(opt);
 	free(val);
 
-	return 0;
+out:
+	return rc;
 }
